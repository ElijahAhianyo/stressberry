# Stressberry Main

[_Documentation generated by Documatic_](https://www.documatic.com)

<!---Documatic-section-Codebase Structure-start--->
## Codebase Structure

<!---Documatic-block-system_architecture-start--->
```mermaid
None
```
<!---Documatic-block-system_architecture-end--->

# #
<!---Documatic-section-Codebase Structure-end--->

<!---Documatic-section-stressberry.main.stress_cpu-start--->
## [stressberry.main.stress_cpu](3-stressberry_main.md#stressberry.main.stress_cpu)

<!---Documatic-section-stress_cpu-start--->
<!---Documatic-block-stressberry.main.stress_cpu-start--->
<details>
	<summary><code>stressberry.main.stress_cpu</code> code snippet</summary>

```python
def stress_cpu(num_cpus, time):
    subprocess.check_call(['stress', '--cpu', str(num_cpus), '--timeout', f'{time}s'])
    return
```
</details>
<!---Documatic-block-stressberry.main.stress_cpu-end--->
<!---Documatic-section-stress_cpu-end--->

# #
<!---Documatic-section-stressberry.main.stress_cpu-end--->

<!---Documatic-section-stressberry.main.cooldown-start--->
## [stressberry.main.cooldown](3-stressberry_main.md#stressberry.main.cooldown)

<!---Documatic-section-cooldown-start--->
```mermaid
flowchart LR
stressberry.main.cooldown-->stressberry.main.measure_temp
```

### Object Calls

* [stressberry.main.measure_temp](3-stressberry_main.md#stressberry.main.measure_temp)

<!---Documatic-block-stressberry.main.cooldown-start--->
<details>
	<summary><code>stressberry.main.cooldown</code> code snippet</summary>

```python
def cooldown(interval=60, filename=None):
    prev_tmp = measure_temp(filename=filename)
    while True:
        tme.sleep(interval)
        tmp = measure_temp(filename=filename)
        print(f'Current temperature: {tmp:4.1f}°C - Previous temperature: {prev_tmp:4.1f}°C')
        if abs(tmp - prev_tmp) < 0.2:
            break
        prev_tmp = tmp
    return tmp
```
</details>
<!---Documatic-block-stressberry.main.cooldown-end--->
<!---Documatic-section-cooldown-end--->

# #
<!---Documatic-section-stressberry.main.cooldown-end--->

<!---Documatic-section-stressberry.main.measure_temp-start--->
## [stressberry.main.measure_temp](3-stressberry_main.md#stressberry.main.measure_temp)

<!---Documatic-section-measure_temp-start--->
<!---Documatic-block-stressberry.main.measure_temp-start--->
<details>
	<summary><code>stressberry.main.measure_temp</code> code snippet</summary>

```python
def measure_temp(filename=None):
    if filename is not None:
        with open(filename) as f:
            temp = float(f.read()) / 1000
    else:
        out = subprocess.check_output(['vcgencmd', 'measure_temp']).decode('utf-8')
        temp = float(out.replace('temp=', '').replace("'C", ''))
    return temp
```
</details>
<!---Documatic-block-stressberry.main.measure_temp-end--->
<!---Documatic-section-measure_temp-end--->

# #
<!---Documatic-section-stressberry.main.measure_temp-end--->

<!---Documatic-section-stressberry.main.measure_core_frequency-start--->
## [stressberry.main.measure_core_frequency](3-stressberry_main.md#stressberry.main.measure_core_frequency)

<!---Documatic-section-measure_core_frequency-start--->
<!---Documatic-block-stressberry.main.measure_core_frequency-start--->
<details>
	<summary><code>stressberry.main.measure_core_frequency</code> code snippet</summary>

```python
def measure_core_frequency(filename=None):
    if filename is not None:
        with open(filename) as f:
            frequency = float(f.read()) / 1000
    else:
        out = subprocess.check_output(['vcgencmd', 'measure_clock arm']).decode('utf-8')
        frequency = float(out.split('=')[1]) / 1000000
    return frequency
```
</details>
<!---Documatic-block-stressberry.main.measure_core_frequency-end--->
<!---Documatic-section-measure_core_frequency-end--->

# #
<!---Documatic-section-stressberry.main.measure_core_frequency-end--->

<!---Documatic-section-stressberry.main.measure_ambient_temperature-start--->
## [stressberry.main.measure_ambient_temperature](3-stressberry_main.md#stressberry.main.measure_ambient_temperature)

<!---Documatic-section-measure_ambient_temperature-start--->
<!---Documatic-block-stressberry.main.measure_ambient_temperature-start--->
<details>
	<summary><code>stressberry.main.measure_ambient_temperature</code> code snippet</summary>

```python
def measure_ambient_temperature(sensor_type='2302', pin='23'):
    try:
        import Adafruit_DHT
    except ImportError as e:
        print('Install adafruit_dht python module: pip install Adafruit_DHT')
        raise e
    sensor_map = {'11': Adafruit_DHT.DHT11, '22': Adafruit_DHT.DHT22, '2302': Adafruit_DHT.AM2302}
    try:
        sensor = sensor_map[sensor_type]
    except KeyError as e:
        print('Invalid ambient temperature sensor')
        raise e
    (_, temperature) = Adafruit_DHT.read_retry(sensor, pin)
    return temperature
```
</details>
<!---Documatic-block-stressberry.main.measure_ambient_temperature-end--->
<!---Documatic-section-measure_ambient_temperature-end--->

# #
<!---Documatic-section-stressberry.main.measure_ambient_temperature-end--->

<!---Documatic-section-stressberry.main.test-start--->
## [stressberry.main.test](3-stressberry_main.md#stressberry.main.test)

<!---Documatic-section-test-start--->
```mermaid
flowchart LR
stressberry.main.test-->stressberry.main.stress_cpu
```

### Object Calls

* [stressberry.main.stress_cpu](3-stressberry_main.md#stressberry.main.stress_cpu)

<!---Documatic-block-stressberry.main.test-start--->
<details>
	<summary><code>stressberry.main.test</code> code snippet</summary>

```python
def test(stress_duration, idle_duration, cores):
    if cores is None:
        cores = cpu_count()
    print(f'Preparing to stress [{cores}] CPU Cores for [{stress_duration}] seconds')
    print(f'Idling for {idle_duration} seconds...')
    tme.sleep(idle_duration)
    stress_cpu(num_cpus=cores, time=stress_duration)
    print(f'Idling for {idle_duration} seconds...')
    tme.sleep(idle_duration)
```
</details>
<!---Documatic-block-stressberry.main.test-end--->
<!---Documatic-section-test-end--->

# #
<!---Documatic-section-stressberry.main.test-end--->

[_Documentation generated by Documatic_](https://www.documatic.com)